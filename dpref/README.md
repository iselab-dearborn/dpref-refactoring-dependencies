<img src="https://user-images.githubusercontent.com/114015/77763035-d72c1700-7010-11ea-9baa-4565d119c235.png" width="300px"/>

Generate a dependency graph by a sequence of refactorings

# Summary

Refactoring is a technique for restructing an existing body of code, altering its internal structure without changing its external behavior [[3]](#3). Given a sequence of refactorings, this tool can generate a dependency graph among them. The manner how the nodes and edges are created depends on the method applied.


# Usage

The tool is running on <a href="https://iselab-dpref.herokuapp.com" target="_blank">https://iselab-dpref.herokuapp.com</a>. To use the tool you have to:

1. Type a refactoring per line in the textarea;
2. Choose the method applied;
3. Choose the output format
4. Click on "Generate" button.

A dialog is going to open based on the output format you have chosen. You have to type the follow pattern in the textarea:


```
{RefactoringType}({SourceClass};{TargetClass};[{Fields}];[{Methods}])
```

To see some example, you can access the "Examples" menu in the tool. Regarding the supported ```{RefactoringType}```, access [here](#Supported-Refactorings).

# Features

Basically the tool has two main features, the method and output format. All of them are described in the following.

### Method

This is the algorithm used for creating the nodes and edges. For now, the tool implements:


- Extract from source class;
- Extract from target class;
- Extract from source and target class;
- Extract from pre-conditions.

### Output format

This is the response the tool will return to you when you call it. For now, the tool supports:

- Graphviz (.dot);
- JavaScript Object Notation (.json);
- CSV (Comma delimited) (.csv).

# Screenshot

Please see the gif below of the tool running.

<img src="https://user-images.githubusercontent.com/114015/77866313-81b65c80-7200-11ea-885b-59c91aadb815.gif" height="500px"/>

# Build

You can download ready builds <a target="_blank" href="https://github.com/thiagodnf/dpref/releases">here</a>. However, to build and run the tool in your machine, clone the repo and access it:

```java
$ cd dpref
```

From the command line with Maven installed in your machine, execute the following command:

```java
$ mvn clean install
```

If you don't have Maven, <a target="_blank" href="https://www.baeldung.com/install-maven-on-windows-linux-mac">click here</a> to see how to install it. The previous command will create .jar file under the "target/" directory with all the dependencies. To run the tool, just execute:

```java
$ java -jar target/dpref-*.jar
```

Now access <a href="http://localhost:8081">http://localhost:8081</a> on your browser to see the app running. A screenshot of the tool is available [here](#Screenshot).

# REST API

This tool makes available a REST API in which you can send a POST request with a sequence of refactorings and get as response the dependency graph of them.

To reach this, you have to send the request for the following resources:

| Type | Path | Description |
|---|:---| :--- |
| **POST** |```/graph​/by-source-class```| Extract from source class |
| **POST** |```/graph​/by-target-class```| Extract from target class |
| **POST** |```/graph​/by-source-target-class```| Extract from source and target classes |
| **POST** |```/graph​/by-pre-conditions```| Extract from pre-conditions |

For example, if you make a post request to ```/graph​/by-source-class``` with the default parameters (see all of them below) by using  the following data:

```json
[
    "ExtractSuperClass(ProductRepository;Class_7;[];[save])",
    "PushDownMethod(Class_7;ProductRepository;[];[save])",
    "PullUpMethod(ProductRepository;Class_7;[];[save])",
    "MoveMethod(Class_7;Product;[];[save])"
]
```

The tool will return the following data:

```json
{
    "data": "digraph G { \n0 [label=\"#0\\nExtractSuperClass\\nProductRepository\\nClass_7\\n[]\\n[save]\"]\n1 [label=\"#1\\nPushDownMethod\\nClass_7\\nProductRepository\\n[]\\n[save]\"]\n2 [label=\"#2\\nPullUpMethod\\nProductRepository\\nClass_7\\n[]\\n[save]\"]\n3 [label=\"#3\\nMoveMethod\\nClass_7\\nProduct\\n[]\\n[save]\"]\n0 -> 2 [dir=both color=\"#2b908f\" penwidth=2]\n1 -> 3 [dir=both color=\"#2b908f\" penwidth=2]\n}",
    "ignoreEmptyNodes": true,
    "useSimpleClassnames": false,
    "numberOfNodes": 4,
    "numberOfEdges": 2
}
```

### Parameters

By using parameters, you can change the response generated by DPRef. They are presented as follows:

| Parameter | Type | Default Value | Options
|---| :---: | :---: | :---: |
| ```outputFormat``` | string | dot | dot, json, csv|
| ```ignoreNodesNoEdges``` | boolean | true |
| ```useSimpleClassnames``` | boolean | true |

For example, you can make a request with ```/graph​/by-source-class?outputFormat=json```.

# Supported Refactorings

This tool supports the following refactorings:

| Refactoring| Description|
| :-- | :-- |
| ```EncapsulateField``` | Generates methods to read and write the value of a field, avoiding direct access to a field|
| ```MoveField``` | Moves a field from a source class to a target class |
| ```MoveMethod``` | Moves a method from a source class to a target class in another hierarchy |
| ```ExtractClass``` | Split a class into two classes by moving some methods and fields to a new class|
| ```ExtractSubClass``` | Creates a subclass and move the some features to the subclass |
| ```ExtractSuperClass``` | Creates a superclass and move the common features to the superclass|
| ```IncreaseFieldSecurity``` | Increases the security of a field from public to protected or from protected to private |
| ```IncreaseMethodSecurity``` | Increases the security of amethod from protected to private or from public to pro-tected |
| ```DecreaseFieldSecurity``` | Decreases the security of a field from private to protected or from protected to public |
| ```DecreaseMethodSecurity``` | Decreases the security of amethod from protected to public or from private to pro-tected |
| ```PullUpField``` | Moves a field from some class(es) to the immediate superclass |
| ```PullUpMethod``` | Moves a method from some class(es) to their immediate superclass |
| ```PushDownField``` | Moves a field from some class to those subclasses that require it |
| ```PushDownMethod``` | Moves a method from some class to those subclasses that require it |

You can find more details about the refactorings in [[1]](#1) and [[2]](#2).

# Contributing

We welcome pull requests, bug fixes and issue reports. Before proposing a change, please discuss your change by raising an <a target="_blank" href="https://github.com/thiagodnf/dpref/issues">issue</a>.

# References

<a id="1" href="#">[1]</a> Ouni, A. (2015). A mono-and multi-objective approach for recommending software refactoring (Ph.D. thesis), Université de Montréal, Canada.

<a id="2" href="#">[2]</a> O’Keeffe, M., & Cinnéide, M. O. (2008). Search-based refactoring for software maintenance. _Journal of Systems and Software_, 81(4), 502-516.

<a id="3" href="#">[3]</a> Fowler, Martin. (2020, March 29). Refactoring. Retrieved from https://refactoring.com

# Powered by

<p float="left">
    <img src="https://user-images.githubusercontent.com/114015/77862361-ed8ccb00-71e8-11ea-8a2b-2e634144bb4b.png" height="73px"/>
    &nbsp;
    &nbsp;
    <img src="https://user-images.githubusercontent.com/114015/77862143-99351b80-71e7-11ea-84b2-62038634f314.png" height="78px"/>
</p>

